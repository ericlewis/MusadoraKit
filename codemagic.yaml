definitions:
  triggering:
    push: &events
      events:
        - push
        - pull_request
    scripts:
      - &buildFramework
        name: Build Framework
        script: sh build.sh
      - &testFramework
        name: Test Framework
        script: |
          set -o pipefail
          sh test.sh
        test_report: build/reports/junit.xml
      - &buildMusadoraApp
        name: Build Musadora App
        working_directory: Musadora
        script: |
          xcodebuild clean build \
           -project Musadora.xcodeproj \
           -scheme Musadora \
           -destination "platform=iOS Simulator,name=iPhone 14" \
           -skipPackagePluginValidation
      - &updateDocs
        name: Update DocC Documentation
        script: |
          sh build_docs.sh
          git add .
          git commit -m "[skip ci] Update DocC Documentation"
          git remote set-url origin https://rudrankriyam:$token@github.com/rryam/MusadoraKit.git
          git pull --ff-only
          git push origin main

workflows:
  musadorakit:
    name: MusadoraKit Workflow
    environment:
      groups:
        - GitHub
    when:
      changeset:
        includes:
          - 'Sources'
          - 'Tests'
    triggering:
      <<: *events
    scripts:
      - *buildFramework
      - *testFramework
  musadorakit-update-docs:
    name: MusadoraKit Docs Update Workflow
    environment:
      groups:
        - GitHub
    scripts:
      - *updateDocs
  musadora:
    name: Musadora Workflow
    environment:
      groups:
        - GitHub
    when:
      changeset:
        includes:
          - 'Musadora'
          - 'Tests'
    triggering:
      <<: *events
    scripts:
      - *buildMusadoraApp
